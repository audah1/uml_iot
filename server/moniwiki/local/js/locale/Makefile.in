# $Id$
#
# local/js/locale/Makefile
#
# This is a replacement for locale/translate.sh to avoid remaking
# files that don't need to be remade.
#

POT_FILE = po/moniwiki.pot

.PHONY: all po clean dep ${POT_FILE}

all	: po js
po 	: # dependencies are auto-generated by 'make dep' , see below
js	: # dependencies are auto-generated by 'make dep' , see below

${POT_FILE} : # dependencies are auto-generated by 'make dep' , see below
	test -f $@ || touch $@
	cp -f $@ $@~
	xgettext --from-code=UTF-8 -L Python -kt_ -k_t -kN_ -o $@.extracted $^
	msgmerge -o $@ $@~ $@.extracted && rm -f $@.extracted

po/%.po : ${POT_FILE}
	test -f $@ || touch $@
	cp -f $@ $@~
	msgmerge -o $@.new $@~ $^ && mv -f $@.new $@

euckr:
	iconv -f UTF-8 -t EUC-KR po/ko.po |sed 's/UTF-8/EUC-KR/' >po/ko_KR.po
	mkdir -p ko_KR
	rm po/ko_KR.po

# Generate .php from .mo rather than .po to maximize
# the probability of agreement between .mo and .php files.
%/moniwiki.js : po/%.po
	mkdir -p $*
	cat $< | awk -f make-js-trans.awk > $@

clean :
	rm -f ${MO_FILES} ${PHP_FILES}

dep :
	$(SHELL) update-makefile.sh


# DO NOT DELETE THIS LINE
#
# The remainder of this file is auto-generated
#
# (Run 'make dep' to regenerate this section.)
#
